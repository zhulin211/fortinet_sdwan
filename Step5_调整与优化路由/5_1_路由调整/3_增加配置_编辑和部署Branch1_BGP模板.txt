####问题####
由于在Hub1_BGP模板的VPN3 --- Route-Map Out方向no-export不生效,
导致Branch1, Branch2学到彼此身后的路由传递到MPLS_PE
可以干掉Hub1_BGP模板的VPN3 --- Route-Map Out方向no-export,然后再Branch1和Branch2的Route-Map In方向set no-export



vyos@MPLS-PE:~$ show ip route
Codes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF,
       I - ISIS, B - BGP, > - selected route, * - FIB route

B>* 0.0.0.0/0 [20/0] via 172.16.100.1, eth0, 00:02:15
B>* 10.1.0.0/16 [20/0] via 172.16.100.1, eth0, 00:02:15
B>* 10.1.1.0/24 [20/0] via 172.16.10.1, eth2, 00:01:32
  *                    via 172.16.20.1, eth3, 00:01:32
B>* 10.1.2.0/24 [20/0] via 172.16.20.1, eth3, 00:01:42
  *                    via 172.16.10.1, eth2, 00:01:42
B>* 10.1.3.0/24 [20/0] via 172.16.100.1, eth0, 00:02:15
B>* 10.1.4.0/24 [20/0] via 172.16.100.1, eth0, 00:02:15
B>* 10.1.6.0/24 [20/0] via 172.16.100.1, eth0, 00:02:15
B>* 10.1.30.0/24 [20/0] via 172.16.30.1, eth4, 00:02:37
C>* 127.0.0.0/8 is directly connected, lo
C>* 172.16.10.0/24 is directly connected, eth2
C>* 172.16.20.0/24 is directly connected, eth3
C>* 172.16.30.0/24 is directly connected, eth4
C>* 172.16.100.0/24 is directly connected, eth0



Branch1 # get router info bgp network 10.1.2.0/24
VRF 0 BGP routing table entry for 10.1.2.0/24
Paths: (1 available, best #1, table Default-IP-Routing-Table)
  Advertised to non peer-group peers:
   172.16.10.254
  Original VRF 0
  Local
    192.168.128.1 from 192.168.191.253 (10.1.100.2)
      Origin IGP metric 0, localpref 100, valid, internal, best
      Community: 33:33  #### 没有no-export
      Originator: 10.1.100.2, Cluster list: 10.1.100.253
      Receive Path ID: 3
      Advertised Path ID: 1
       Last update: Sat Oct 15 20:56:11 2022




Branch2 # get router info bgp network 10.1.1.0/24
VRF 0 BGP routing table entry for 10.1.1.0/24
Paths: (1 available, best #1, table Default-IP-Routing-Table)
  Advertised to non peer-group peers:
   172.16.20.254
  Original VRF 0
  Local
    192.168.128.2 from 192.168.191.253 (10.1.100.1)
      Origin IGP metric 0, localpref 100, valid, internal, best
      Community: 33:33   #### 没有no-export
      Originator: 10.1.100.1, Cluster list: 10.1.100.253
      Receive Path ID: 1
      Advertised Path ID: 1
       Last update: Sat Oct 15 21:26:34 2022




####Branch1_BGP模板调整如下配置####
===========================编辑======================================================
Device Manager --- Provisioning Templates --- BGP Template

=================================================================================
Branch1_BGP --- Edit

=================================================================================

Neighbors --- 192.168.191.253[VPN3] --- Edit

------------------------------------------------------

Route Map In --- enable --- [+]

    Create New Route Map:

        Name: set_no_export

        Rules --- Create New

                  ID: 1
                  Action Permit
                  Set Community --- enable --- no-export

                  <OK>
        <OK>

<OK>

=================================================================================


===================部署===========================================================
Device Manager --- Device & Groups --- Managed FortiGated

=================================================================================
Branch1 (勾选) --- Install --- Install Wizard ---
                              Install Policy Package & Device Settings (勾选)
                                                       Policy Package: Branch1_FW_Policy
                                                                       --- Next
                                                                       --- Next
                                                                       --- Install
